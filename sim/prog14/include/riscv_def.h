#ifndef __RISCV_DEF__
#define __RISCV_DEF__

#define EXIT_CODE_PASS 0x1
#define EXIT_CODE_ERROR 0x3

#define PGSIZE 4096
#define TRAPFRAM_SIZE (35 * 8)
#define STACK_TOP (_end + PGSIZE)

#define set_csr(name, value) { \
    asm volatile("csrs " #name ", %0"::"r"(value)); \
}

#define clear_csr(name, value) { \
    asm volatile("csrc " #name ", %0"::"r"(value)); \
}

#define write_csr(name, value) { \
    asm volatile("csrw " #name ", %0"::"r"(value)); \
}

#define read_csr(name, value) { \
    asm volatile("csrr %0, " #name:"=r"(value)); \
}

#define get_field(x, mask) (((x) & (mask)) / ((mask) & ~((mask) << 1)))
#define set_field(x, mask, value) \
    ((x) & ~(mask)) | ((value) * ((mask) & ~((mask) << 1)) & (mask))

#define SYSCALL_PUTCHAR 0x0101
#define SYSCALL_SYS 0x0000

#define PRV_U 0x0
#define PRV_S 0x1
#define PRV_H 0x2
#define PRV_M 0x3

#define CSR_USTATUS_ADDR 0x000
#define CSR_UIE_ADDR 0x004
#define CSR_UTVEC_ADDR 0x005
#define CSR_USCRATCH_ADDR 0x040
#define CSR_UEPC_ADDR 0x041
#define CSR_UCAUSE_ADDR 0x042
#define CSR_UTVAL_ADDR 0x043
#define CSR_UIP_ADDR 0x044
#define CSR_FFLAGS_ADDR 0x001
#define CSR_FRM_ADDR 0x002
#define CSR_FCSR_ADDR 0x003
#define CSR_CYCLE_ADDR 0xc00
#define CSR_TIME_ADDR 0xc01
#define CSR_INSTRET_ADDR 0xc02
#define CSR_HPMCOUNTER3_ADDR 0xc03
#define CSR_HPMCOUNTER4_ADDR 0xc04
#define CSR_HPMCOUNTER5_ADDR 0xc05
#define CSR_HPMCOUNTER6_ADDR 0xc06
#define CSR_HPMCOUNTER7_ADDR 0xc07
#define CSR_HPMCOUNTER8_ADDR 0xc08
#define CSR_HPMCOUNTER9_ADDR 0xc09
#define CSR_HPMCOUNTER10_ADDR 0xc0a
#define CSR_HPMCOUNTER11_ADDR 0xc0b
#define CSR_HPMCOUNTER12_ADDR 0xc0c
#define CSR_HPMCOUNTER13_ADDR 0xc0d
#define CSR_HPMCOUNTER14_ADDR 0xc0e
#define CSR_HPMCOUNTER15_ADDR 0xc0f
#define CSR_HPMCOUNTER16_ADDR 0xc10
#define CSR_HPMCOUNTER17_ADDR 0xc11
#define CSR_HPMCOUNTER18_ADDR 0xc12
#define CSR_HPMCOUNTER19_ADDR 0xc13
#define CSR_HPMCOUNTER20_ADDR 0xc14
#define CSR_HPMCOUNTER21_ADDR 0xc15
#define CSR_HPMCOUNTER22_ADDR 0xc16
#define CSR_HPMCOUNTER23_ADDR 0xc17
#define CSR_HPMCOUNTER24_ADDR 0xc18
#define CSR_HPMCOUNTER25_ADDR 0xc19
#define CSR_HPMCOUNTER26_ADDR 0xc1a
#define CSR_HPMCOUNTER27_ADDR 0xc1b
#define CSR_HPMCOUNTER28_ADDR 0xc1c
#define CSR_HPMCOUNTER29_ADDR 0xc1d
#define CSR_HPMCOUNTER30_ADDR 0xc1e
#define CSR_HPMCOUNTER31_ADDR 0xc1f
#define CSR_CYCLEH_ADDR 0xc80
#define CSR_TIMEH_ADDR 0xc81
#define CSR_INSTRETH_ADDR 0xc82
#define CSR_HPMCOUNTER3H_ADDR 0xc83
#define CSR_HPMCOUNTER4H_ADDR 0xc84
#define CSR_HPMCOUNTER5H_ADDR 0xc85
#define CSR_HPMCOUNTER6H_ADDR 0xc86
#define CSR_HPMCOUNTER7H_ADDR 0xc87
#define CSR_HPMCOUNTER8H_ADDR 0xc88
#define CSR_HPMCOUNTER9H_ADDR 0xc89
#define CSR_HPMCOUNTER10H_ADDR 0xc8a
#define CSR_HPMCOUNTER11H_ADDR 0xc8b
#define CSR_HPMCOUNTER12H_ADDR 0xc8c
#define CSR_HPMCOUNTER13H_ADDR 0xc8d
#define CSR_HPMCOUNTER14H_ADDR 0xc8e
#define CSR_HPMCOUNTER15H_ADDR 0xc8f
#define CSR_HPMCOUNTER16H_ADDR 0xc90
#define CSR_HPMCOUNTER17H_ADDR 0xc91
#define CSR_HPMCOUNTER18H_ADDR 0xc92
#define CSR_HPMCOUNTER19H_ADDR 0xc93
#define CSR_HPMCOUNTER20H_ADDR 0xc94
#define CSR_HPMCOUNTER21H_ADDR 0xc95
#define CSR_HPMCOUNTER22H_ADDR 0xc96
#define CSR_HPMCOUNTER23H_ADDR 0xc97
#define CSR_HPMCOUNTER24H_ADDR 0xc98
#define CSR_HPMCOUNTER25H_ADDR 0xc99
#define CSR_HPMCOUNTER26H_ADDR 0xc9a
#define CSR_HPMCOUNTER27H_ADDR 0xc9b
#define CSR_HPMCOUNTER28H_ADDR 0xc9c
#define CSR_HPMCOUNTER29H_ADDR 0xc9d
#define CSR_HPMCOUNTER30H_ADDR 0xc9e
#define CSR_HPMCOUNTER31H_ADDR 0xc9f

#define CSR_SSTATUS_ADDR 0x100
#define CSR_SEDELEG_ADDR 0x102
#define CSR_SIDELEG_ADDR 0x103
#define CSR_SIE_ADDR 0x104
#define CSR_STVEC_ADDR 0x105
#define CSR_SCOUNTEREN_ADDR 0x106
#define CSR_SSCRATCH_ADDR 0x140
#define CSR_SEPC_ADDR 0x141
#define CSR_SCAUSE_ADDR 0x142
#define CSR_STVAL_ADDR 0x143
#define CSR_SIP_ADDR 0x144
#define CSR_SATP_ADDR 0x180

#define CSR_MVENDORID_ADDR 0xf11
#define CSR_MARCHID_ADDR 0xf12
#define CSR_MIMPID_ADDR 0xf13
#define CSR_MHARTID_ADDR 0xf14
#define CSR_MSTATUS_ADDR 0x300
#define CSR_MISA_ADDR 0x301
#define CSR_MEDELEG_ADDR 0x302
#define CSR_MIDELEG_ADDR 0x303
#define CSR_MIE_ADDR 0x304
#define CSR_MTVEC_ADDR 0x305
#define CSR_MCOUNTEREN_ADDR 0x306
#define CSR_MSCRATCH_ADDR 0x340
#define CSR_MEPC_ADDR 0x341
#define CSR_MCAUSE_ADDR 0x342
#define CSR_MTVAL_ADDR 0x343
#define CSR_MIP_ADDR 0x344
#define CSR_PMPCFG0_ADDR 0x3a0
#define CSR_PMPCFG1_ADDR 0x3a1
#define CSR_PMPCFG2_ADDR 0x3a2
#define CSR_PMPCFG3_ADDR 0x3a3
#define CSR_PMPADDR0_ADDR 0x3b0
#define CSR_PMPADDR1_ADDR 0x3b1
#define CSR_PMPADDR2_ADDR 0x3b2
#define CSR_PMPADDR3_ADDR 0x3b3
#define CSR_PMPADDR4_ADDR 0x3b4
#define CSR_PMPADDR5_ADDR 0x3b5
#define CSR_PMPADDR6_ADDR 0x3b6
#define CSR_PMPADDR7_ADDR 0x3b7
#define CSR_PMPADDR8_ADDR 0x3b8
#define CSR_PMPADDR9_ADDR 0x3b9
#define CSR_PMPADDR10_ADDR 0x3ba
#define CSR_PMPADDR11_ADDR 0x3bb
#define CSR_PMPADDR12_ADDR 0x3bc
#define CSR_PMPADDR13_ADDR 0x3bd
#define CSR_PMPADDR14_ADDR 0x3be
#define CSR_PMPADDR15_ADDR 0x3bf
#define CSR_MCYCLE_ADDR 0xb00
#define CSR_MINSTRET_ADDR 0xb02
#define CSR_MHPMCOUNTER3_ADDR 0xb03
#define CSR_MHPMCOUNTER4_ADDR 0xb04
#define CSR_MHPMCOUNTER5_ADDR 0xb05
#define CSR_MHPMCOUNTER6_ADDR 0xb06
#define CSR_MHPMCOUNTER7_ADDR 0xb07
#define CSR_MHPMCOUNTER8_ADDR 0xb08
#define CSR_MHPMCOUNTER9_ADDR 0xb09
#define CSR_MHPMCOUNTER10_ADDR 0xb0a
#define CSR_MHPMCOUNTER11_ADDR 0xb0b
#define CSR_MHPMCOUNTER12_ADDR 0xb0c
#define CSR_MHPMCOUNTER13_ADDR 0xb0d
#define CSR_MHPMCOUNTER14_ADDR 0xb0e
#define CSR_MHPMCOUNTER15_ADDR 0xb0f
#define CSR_MHPMCOUNTER16_ADDR 0xb10
#define CSR_MHPMCOUNTER17_ADDR 0xb11
#define CSR_MHPMCOUNTER18_ADDR 0xb12
#define CSR_MHPMCOUNTER19_ADDR 0xb13
#define CSR_MHPMCOUNTER20_ADDR 0xb14
#define CSR_MHPMCOUNTER21_ADDR 0xb15
#define CSR_MHPMCOUNTER22_ADDR 0xb16
#define CSR_MHPMCOUNTER23_ADDR 0xb17
#define CSR_MHPMCOUNTER24_ADDR 0xb18
#define CSR_MHPMCOUNTER25_ADDR 0xb19
#define CSR_MHPMCOUNTER26_ADDR 0xb1a
#define CSR_MHPMCOUNTER27_ADDR 0xb1b
#define CSR_MHPMCOUNTER28_ADDR 0xb1c
#define CSR_MHPMCOUNTER29_ADDR 0xb1d
#define CSR_MHPMCOUNTER30_ADDR 0xb1e
#define CSR_MHPMCOUNTER31_ADDR 0xb1f
#define CSR_MCYCLEH_ADDR 0xb80
#define CSR_MINSTRETH_ADDR 0xb82
#define CSR_MHPMCOUNTER3H_ADDR 0xb83
#define CSR_MHPMCOUNTER4H_ADDR 0xb84
#define CSR_MHPMCOUNTER5H_ADDR 0xb85
#define CSR_MHPMCOUNTER6H_ADDR 0xb86
#define CSR_MHPMCOUNTER7H_ADDR 0xb87
#define CSR_MHPMCOUNTER8H_ADDR 0xb88
#define CSR_MHPMCOUNTER9H_ADDR 0xb89
#define CSR_MHPMCOUNTER10H_ADDR 0xb8a
#define CSR_MHPMCOUNTER11H_ADDR 0xb8b
#define CSR_MHPMCOUNTER12H_ADDR 0xb8c
#define CSR_MHPMCOUNTER13H_ADDR 0xb8d
#define CSR_MHPMCOUNTER14H_ADDR 0xb8e
#define CSR_MHPMCOUNTER15H_ADDR 0xb8f
#define CSR_MHPMCOUNTER16H_ADDR 0xb90
#define CSR_MHPMCOUNTER17H_ADDR 0xb91
#define CSR_MHPMCOUNTER18H_ADDR 0xb92
#define CSR_MHPMCOUNTER19H_ADDR 0xb93
#define CSR_MHPMCOUNTER20H_ADDR 0xb94
#define CSR_MHPMCOUNTER21H_ADDR 0xb95
#define CSR_MHPMCOUNTER22H_ADDR 0xb96
#define CSR_MHPMCOUNTER23H_ADDR 0xb97
#define CSR_MHPMCOUNTER24H_ADDR 0xb98
#define CSR_MHPMCOUNTER25H_ADDR 0xb99
#define CSR_MHPMCOUNTER26H_ADDR 0xb9a
#define CSR_MHPMCOUNTER27H_ADDR 0xb9b
#define CSR_MHPMCOUNTER28H_ADDR 0xb9c
#define CSR_MHPMCOUNTER29H_ADDR 0xb9d
#define CSR_MHPMCOUNTER30H_ADDR 0xb9e
#define CSR_MHPMCOUNTER31H_ADDR 0xb9f
#define CSR_MHPMEVENT3_ADDR 0x323
#define CSR_MHPMEVENT4_ADDR 0x324
#define CSR_MHPMEVENT5_ADDR 0x325
#define CSR_MHPMEVENT6_ADDR 0x326
#define CSR_MHPMEVENT7_ADDR 0x327
#define CSR_MHPMEVENT8_ADDR 0x328
#define CSR_MHPMEVENT9_ADDR 0x329
#define CSR_MHPMEVENT10_ADDR 0x32a
#define CSR_MHPMEVENT11_ADDR 0x32b
#define CSR_MHPMEVENT12_ADDR 0x32c
#define CSR_MHPMEVENT13_ADDR 0x32d
#define CSR_MHPMEVENT14_ADDR 0x32e
#define CSR_MHPMEVENT15_ADDR 0x32f
#define CSR_MHPMEVENT16_ADDR 0x330
#define CSR_MHPMEVENT17_ADDR 0x331
#define CSR_MHPMEVENT18_ADDR 0x332
#define CSR_MHPMEVENT19_ADDR 0x333
#define CSR_MHPMEVENT20_ADDR 0x334
#define CSR_MHPMEVENT21_ADDR 0x335
#define CSR_MHPMEVENT22_ADDR 0x336
#define CSR_MHPMEVENT23_ADDR 0x337
#define CSR_MHPMEVENT24_ADDR 0x338
#define CSR_MHPMEVENT25_ADDR 0x339
#define CSR_MHPMEVENT26_ADDR 0x33a
#define CSR_MHPMEVENT27_ADDR 0x33b
#define CSR_MHPMEVENT28_ADDR 0x33c
#define CSR_MHPMEVENT29_ADDR 0x33d
#define CSR_MHPMEVENT30_ADDR 0x33e
#define CSR_MHPMEVENT31_ADDR 0x33f

#define CSR_TSELECT_ADDR 0x7a0
#define CSR_TDATA1_ADDR 0x7a1
#define CSR_TDATA2_ADDR 0x7a2
#define CSR_TDATA3_ADDR 0x7a3
#define CSR_DCSR_ADDR 0x7b0
#define CSR_DPC_ADDR 0x7b1
#define CSR_DSCRATCH_ADDR 0x7b2

#define CAUSE_MISALIGNED_FETCH 0x0
#define CAUSE_INSTRUCTION_ACCESS 0x1
#define CAUSE_ILLEGAL_INSTRUCTION 0x2
#define CAUSE_BREAKPOINT 0x3
#define CAUSE_MISALIGNED_LOAD 0x4
#define CAUSE_LOAD_ACCESS 0x5
#define CAUSE_MISALIGNED_STORE 0x6
#define CAUSE_STORE_ACCESS 0x7
#define CAUSE_USER_ECALL 0x8
#define CAUSE_SUPERVISOR_ECALL 0x9
#define CAUSE_HYPERVISOR_ECALL 0xa
#define CAUSE_MACHINE_ECALL 0xb
#define CAUSE_INSTRUCTION_PAGE_FAULT 0xc
#define CAUSE_LOAD_PAGE_FAULT 0xd
#define CAUSE_STORE_PAGE_FAULT 0xf

#define PTE_V (1 << 0)
#define PTE_R (1 << 1)
#define PTE_W (1 << 2)
#define PTE_X (1 << 3)
#define PTE_U (1 << 4)
#define PTE_G (1 << 5)
#define PTE_A (1 << 6)
#define PTE_D (1 << 7)
#define PTE_RSW (3 << 8)
#define PTE_PPN_SHIFT 10

#define PAGE_SHIFT 12

#define SATP_MODE_NONE 0
#define SATP_MODE_SV39 8
#define SATP_MODE_SV48 9
#define SATP_MODE_SV57 10
#define SATP_MODE_SV64 11

#define SATP_MODE (0xfUL << 60)
#define SATP_ASID (0xffffUL << 44)
#define SATP_PPN ((1UL << 44) - 1UL)

#define MSTATUS_SIE (0x1UL << 1)
#define MSTATUS_MIE (0x1UL << 3)
#define MSTATUS_SPIE (0x1UL << 5)
#define MSTATUS_MPIE (0x1UL << 7)
#define MSTATUS_SPP (0x1UL << 8)
#define MSTATUS_MPP (0x3UL << 11)
#define MSTATUS_FS (0x3UL << 13)
#define MSTATUS_XS (0x3UL << 15)
#define MSTATUS_MPRV (0x1UL << 17)
#define MSTATUS_SUM (0x1UL << 18)
#define MSTATUS_MXR (0x1UL << 19)
#define MSTATUS_TW (0x1UL << 21)
#define MSTATUS_TVM (0x1UL << 20)
#define MSTATUS_TSR (0x1UL << 22)
#define MSTATUS_UXL (0x3UL << 32)
#define MSTATUS_SXL (0x3UL << 34)

#define SSTATUS_MASK                                                      \
    (MSTATUS_SIE | MSTATUS_SPIE | MSTATUS_SPP | MSTATUS_FS | MSTATUS_XS | \
     MSTATUS_SUM | MSTATUS_MXR | MSTATUS_UXL)

#define MIP_SSIP (0x1UL << 1)
#define MIP_MSIP (0x1UL << 3)
#define MIP_STIP (0x1UL << 5)
#define MIP_MTIP (0x1UL << 7)
#define MIP_SEIP (0x1UL << 9)
#define MIP_MEIP (0x1UL << 11)

#define PMP_R (0x1UL << 0)
#define PMP_W (0x1UL << 1)
#define PMP_X (0x1UL << 2)
#define PMP_A (0x3UL << 3)
#define PMP_L (0x1UL << 7)

#define PMP_TOR 1
#define PMP_NA4 2
#define PMP_NAPOT 3

#define FCSR_FFLAGS_SHIFT 0
#define FCSR_FRM_SHIFT 5

#define FFLAGS_MASK 0x1fUL
#define FRM_MASK 0x7UL

#define PMPADDR_MASK ((0x1UL << 54) - 1UL)

#define IRQ_NONSTANDARD 12
#endif
